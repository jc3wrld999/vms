<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/default_layout}"
>
  <!-- layout Content -->
  <th:block layout:fragment="content-wrapper">
    <div class="content-wrapper">
      <link
        href="https://api.mapbox.com/mapbox-gl-js/v2.6.0/mapbox-gl.css"
        rel="stylesheet"
      />
      <script
        src="https://api.mapbox.com/mapbox-gl-js/v2.6.0/mapbox-gl.js"
      ></script>
      <style>
        body {
          margin: 0;
          padding: 0;
        }
        #map {
          position: absolute;
          top: 0;
          bottom: 0;
          width: 100%;
        }
      </style>
      <div id="map"></div>
      <script>
        // TO MAKE THE MAP APPEAR YOU MUST
        // ADD YOUR ACCESS TOKEN FROM
        // https://account.mapbox.com
        mapboxgl.accessToken =
          "pk.eyJ1IjoiamMzd3JsZDk5OSIsImEiOiJjbDRtdGV3ODEwMm9wM2ttZXpjZHRnZHFhIn0.3WMaZZTngmkKBFLQY1IgcQ"; // 계정에 있는 Public Access Token 입력
        const map = new mapboxgl.Map({
          container: "map",
          style: "mapbox://styles/mapbox/streets-v11",
          center: [126.886199, 37.476106],
          zoom: 11,
        });

        $(function () {
          fetchRoutePath();
        });
        // 특정 버스 노선도 조회
        function fetchRoutePath() {
          $.ajax({
            url: "/api/rest/getRoutePathByRouteId/100100118",
            type: "get",
            // data: { idArr: "test" },
            // dataType: "JSON",
            success: function (r) {
              console.log(r);
              getRoutePath(r);
            },
            error: function (e) {
              console.log(e);
            },
          });
        }
        function getRoutePath(data) {
          // document.getElementById("heading-num").innerHTML =
          //   data[0]["route_name"] + "번 버스 노선";
          const copy = [];
          for (i = 0; i < data.length; i++) {
            var arr = [data[i]["coordinate_x"], data[i]["coordinate_y"]];
            copy.push(arr);
          }
          console.log(copy);
          map.on("load", () => {
            map.addSource("route", {
              type: "geojson",
              data: {
                type: "Feature",
                properties: {},
                geometry: {
                  type: "LineString",
                  coordinates: copy,
                },
              },
            });
            map.addLayer({
              id: "route",
              type: "line",
              source: "route",
              layout: {
                "line-join": "round",
                "line-cap": "round",
              },
              paint: {
                "line-color": "#FF6319",
                "line-width": 4,
              },
            });
          });
        }
      </script>
    </div>
  </th:block>
</html>
